<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Privado</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #ece5dd;
    display: flex;
    flex-direction: column;
    height: 100vh;
    margin: 0;
}
.header {
    background: #075e54;
    color: white;
    padding: 10px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.profile {
    display: flex;
    align-items: center;
    gap: 10px;
}
.profile img {
    width: 42px;
    height: 42px;
    border-radius: 50%;
    border: 2px solid white;
}
.messages {
    flex: 1;
    padding: 12px;
    overflow-y: auto;
}
.message {
    background: #dcf8c6;
    padding: 8px 12px;
    border-radius: 10px;
    margin-bottom: 8px;
    max-width: 75%;
    font-size: 14px;
}
.input-box {
    display: flex;
    border-top: 1px solid #ccc;
    background: white;
}
.input-box input {
    flex: 1;
    padding: 12px;
    border: none;
    outline: none;
}
.input-box button {
    background: #075e54;
    color: white;
    border: none;
    padding: 12px 16px;
    cursor: pointer;
}
</style>
</head>

<body>

<div class="header">
    <div class="profile">
        <img src="perfil.png">
        <div>
            <div><b>Soporte</b></div>
            <div style="font-size:12px;">En lÃ­nea</div>
        </div>
    </div>
</div>

<div class="messages" id="messages"></div>

<div class="input-box">
    <input id="msg" placeholder="Escribe un mensaje...">
    <button onclick="sendMessage()">Enviar</button>
</div>

<script>
const messagesDiv = document.getElementById("messages");
const urlParams = new URLSearchParams(window.location.search);
const roomId = urlParams.get("room");

let ws = new WebSocket("ws://localhost:8080?room=" + roomId);

const despedidas = ["adios", "adiÃ³s", "gracias", "bye", "hasta luego"];

ws.onmessage = (e) => {
    const msg = JSON.parse(e.data);
    addMessage(msg.user, msg.text);
};

function addMessage(user, text) {
    const div = document.createElement("div");
    div.className = "message";
    div.textContent = `${user}: ${text}`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

function detectarDespedida(texto) {
    texto = texto.toLowerCase();
    return despedidas.some(p => texto.includes(p));
}

function sendMessage() {
    const input = document.getElementById("msg");
    const text = input.value.trim();
    if (!text) return;

    addMessage("TÃº", text);
    ws.send(JSON.stringify({ user: "Usuario", text, room: roomId }));

    if (detectarDespedida(text)) {
        setTimeout(() => {
            const auto = "Gracias por su tiempo ðŸ˜Š\nEstamos a sus Ã³rdenes para cualquier duda.";
            addMessage("Soporte", auto);
            ws.send(JSON.stringify({ user: "Soporte", text: auto, room: roomId }));
        }, 1200);
    }

    input.value = "";
}
</script>

</body>
</html>
